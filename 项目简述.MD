## 1、在项目中发挥的作用、对项目的理解以及自己的看法
>刚开始是两个人，工作量按渠道划分，后期因为业务发展，就只有我一个人负责这个事情。刚开始是单机爬取，后面我写了这个新的爬虫系统后，需要将之前的一些打通的的渠道整合到新系统中。**如果问了前期的工作再说，不问不说**

### 项目中的作用
> 主导了这个分布式爬虫系统的迭代和开发工作，并负责迄今为止两个大版本的设计和开发，将日均爬取量从2000~3000条提升到8000~12000条，当然跟部署的机器数量有关，目前是5台机器，其中有三台机器是具体的爬取机器，其余两台是负责调度分发的机器。通过这个项目，我们社区不仅仅获得了初始的冷启动内容池，而且在后续的推进中，对我们社区内容这块业务持续输血，尤其是在引进了站外主播授权后的一对一爬取之后。

### 项目的理解和看法

> 刚开始对这个系统的定位仅仅是为了满足部门业务需求，后面随着版本的演变，逐步产生了打造为公共平台的想法，做成跨部门使用的一个公用的爬虫平台，不仅仅可以为自己的部门服务，还可以为其他部门服务。为其他部门服务主要体现在两块，针对现有已经打通的爬取渠道的内容共享分发，以及后续提供对定制化爬取任务的支持。

> 关于定制化的内容爬取，只需要业务方编写对应的爬取逻辑代码，提交到系统上即可，至于爬取过程中防反爬处理、任务重试、内容下载等功能都不需要重复开发，由我们这个爬虫平台来提供

### 定制化开发过程中，如何实现业务方的爬取业务逻辑的热加载

> 利用类的热加载，以及如何处理业务方之间的类隔离（这一块调研学习中）

### 项目部署

#### 平缓部署

> 执行节点部署前，触发任务关闭开关，不再接收新任务，等当前任务执行完成后，关闭与中心节点的互联，拉出集群节点，停机部署，然后重启。重启完成后，重新与中心节点建立连接，加入集群节点，接收新任务的分发、执行

> 中心节点在部署前，广播自己即将要下线的消息，并将自身所持有的任务迁移到离自己最近的其他中心节点上，迁移过程中，仍然可以旧任务的ACK请求，但不再接受提交的新任务，也不再分发任务。迁移完成后，再次广播自己下线的消息，然后下线、停机部署。重启后，广播自己上线的消息，加入集群节点。其他节点收到上线消息后，更新本地维护的节点信息。

#### 宕机恢复

> 中心节点重启，由数据库做兜底，重启时，从数据库中重新加载出之前持有的任务、以及未被任何中心节点持有的任务，重新映射到哈希环上，加入自己的分发调度之中

> 执行节点重启，就是简单的重启，至于之前宕机前的任务回收、重新调度分发，由中心节点来处理。每一次执行节点重启，都相当于一个新的执行节点。

## 2、从项目中学到了什么，使用了什么技术，遇到了什么挑战以及是怎么解决的

> 在这个爬虫项目里面，我学些到了爬虫领域的相关知识，以及对于分布式系统的设计与实践相关的知识。以前对于分布式系统的设计更多的是停留在理论阶段，通过这个项目，我从0到1的完成了对于这个系统的设计与每一步开发，对于分布式系统开发有了更深入的理解。另外就是站在业务发展的角度上，对于系统迭代的方向有了更加成熟、深入的思考。

> 使用了 Netty、Redis、MQ、Zookeer等技术中间件

> 挑战来自两方面，一方面是反爬这一块，绝大部分公司对于爬虫都会存在一些反爬机制，以及防盗链加密机制，尤其是资源防盗链算法这一块，每个公司的算法不一样，并且混淆隐藏在代码里。自己自学了一些安卓开发的知识，通过对目标APP的安装包进行反编译，得出对应的代码，通过对代码进行分析，计算出对应的防盗链加密算法。对于部分公司采用了底层的SO库存放加密算法，这一块的破解难度比较大，自己更多的是依赖于从网上破解论坛上寻找破解算法，或者通过架设中间者代理服务器，对资源URL进行拦截直接取得URL
>
> 其实，还有另外一个小收获，就是自己通过做爬虫，接触到了一些关于爬虫相关的一些产业信息吧，在一些破解论坛或者黑市中，对于各大公司的防盗链算法、token算法、以及相关数据甚至都是明码标价售卖的。之前只是听过数据售卖，但是不知道这么直接和暴利，算是真实的感受了一把。

> 另外一个挑战，就是在这个新系统上线之初，因为是分布式的一个系统，节点之间交互、任务流转，以及宕机故障转移等，没有考虑健全，导致上线之后，遇到了任务丢失、循环重复爬取、重复分发调度等情况。后面针对这些情况进行全方位的罗列，对于各种可能的情况进行人工模拟，比如人工模拟宕机、重复分发任务等，进行了各种场景演示，并不断地修复相关bug，最终可以正式交付上线。

## 3、工作以来遇到的最大挫折，以及如何解决的，从中学到了什么

> 在携程时，做库存缓存系统时，因为在供应商层和平台之间引入了一层缓存系统，因为是缓存，所以肯定会存在一定的数据不一致性，为了最大程度的降低这个数据的不一致性，我们希望采用推拉组合的方式来将降低不一致性。拉就是我们平台定期去供应商系统拉取产品信息以及相关库存，推就是供应商把库存改动信息推给我们。但是鉴于我们携程平台只是供应商的一个分发渠道，他们对外的服务接口只有一套，供所有的分发渠道来使用。所以需要他们单独对接我们的这套缓存系统的推模式。
> 
> 为了完成缓存准确率的这块指标，当时我和另一个同事，带着产品、商务主动找各个供应商的技术团队进行沟通，小供应商很配合，大供应商有些不太配合，不愿意投入单独的人力到这块来。大头订单都是在大供应商那头，所以这一块的准确率不是很高，导致前台的客诉变多。因为客诉变多，部门主管要求我们停止采用这套系统，改回到原先的方式。放弃的话，做了那么久又不太甘心，毕竟投入了那么多时间，并且也是我工作以来的第一个作为核心开发人员的项目。
>
> 后面，我们做这个系统的同事、和产品一起开了会，在想供应商为什么不愿意配合，直接的原因就是供应商配合我们做这个，他们得不到直接的回报和好处。于是，我们就想出了把缓存准确率作为资源推荐位的一项计算项，如果这个供应商产品的缓存正确率低，那么拿到推荐位的可能性就相对应变小。相当于变相的促使供应商配合我们做整改。
>
> 做了这个决定后，那些不配合的供应商很快就主动的和我们完成了这块的技术对接。整个缓存系统上线一个月后，因为访问速度加快，用户的整体体验大幅提高，我们的订单转化率提升了0.9%，之前转化率是5%左右，日均UV在 6W 到 8W 之间，PV在15W 到 25W 之间，日均订单在3000 ~ 4000单，相当于多了几百单，这个对于供应商来说也是有订单增长，算是一种互利共赢，后面再涉及缓存系统的更改调整时，供应商就变得很配合，尤其是大供应商。
>
> 沟通是很重要的一件事情，而且合理的利用自己平台的资源更为重要。一开始要求他们整改，他们不配合，到后面的主动配合，就是一个很明显的转变。另外，如果做一件事情，需要外界的协助，那么首先要能够GET住对方关心的点，并且最后能证明对他们有收益。

## 4、个人的优点和缺点

### 优点
> 对新事物的接收能力比较强，进入携程做了一段时间的`.Net` ，后面携程技术栈转Java，又做回Java，并且完成部分`.Net`项目到Java的转换。到了喜马拉雅这边，又接触到了爬虫相关的开发工作，并且完成得还行，没有给拖慢团队业务的发展。
>
> 思考能力比较强，喜欢对现有的业务东西进行思考，并能基于现有的业务状况，站在技术的角度上，来进行优化改进。比如这个分布式爬虫系统的版本迭代，就是我通过对于业务需求，以及现有系统的一些短板的思考，来主动进行的版本迭代和升级，从而更好地对社区业务内容进行输血。
>
> 抗压能力，社区是喜马拉雅去年年初新举的业务，所以前中期是一个较为的辛苦的过程，包括之前做爬虫本来是两个人，后面就变我一个人，但是还是坚持做了下来，并且同时支持社区动态功能模块的业务迭代，业务迭代上没有因为开发资源较少，而拖慢速度。

> 有的时候对一件事情的思考思考过多，容易钻牛角尖，陷入其中，浪费了不少的时间。做爬虫时，如何对安装包进行反编译这一块，投入了太多的时间，其实到后来发现真正用来使用的实战知识并不需要那么多。

## 5、最近在学习什么新技术

> 最近在看JVM的一些新特性，现在JDK的迭代速度越来越快了，时刻保持知识同步，以此使自己不要太落伍，比如ZGC（JDK11）、局部变量类型推断（JDK9）

> 在看一些系统设计相关的架构方案，希望能够加深一些自己对于系统设计的相关知识技能。

## 6、有什么用什么想问他的

> 你们部门目前的业务主要内容是什么，以及未来的发展方向是什么

> 如果我最后能进入你们部门的话，我能为部门做些什么，也就是我的工作内容